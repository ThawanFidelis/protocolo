mudar_select_html();

function mudar_select_html () {
  options = $('.requerimentos option');
  $('.requerimentos').html(''); 

  $('#tramitacao_setor_origem_id').change(function  () {

    setor_id = $(this).attr("value");
    requerimentos_filtrados = [];
    lista_requerimentos = requerimentos_para_setor_escolhido(setor_id);

    options.each(function  (index, objeto) {
      for (var i = 0; i < lista_requerimentos.length; i++) {
        if (objeto.value == lista_requerimentos[i]) {requerimentos_filtrados.push(objeto);};
      };
    });
    $('.requerimentos').html(requerimentos_filtrados);
  });
};

function requerimentos_para_setor_escolhido (setor_id) {
  setores_requerimentos = [];
  
  <% @requerimentos_filtrados.each do |setor, lista_requerimentos| %>
    setores_requerimentos.push([<%= setor.id %>, <%= lista_requerimentos.map{|r| r.id } %>]);
  <% end %>

  // setores_requerimentos = Array do tipo [[setor_id,[requerimento1_id,requerimento2_id]], .... ]
  for (var i = 0; i < setores_requerimentos.length; i++) {
    if (setores_requerimentos[i][0] == setor_id) {
      requerimentos = setores_requerimentos[i][1];
    };
  };
  return requerimentos;
};
